"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LoginResults = exports.BaseScraperWithBrowser = void 0;
var _puppeteer = _interopRequireDefault(require("puppeteer"));
var _definitions = require("../definitions");
var _debug = require("../helpers/debug");
var _elementsInteractions = require("../helpers/elements-interactions");
var _navigation = require("../helpers/navigation");
var _baseScraper = require("./base-scraper");
var _errors = require("./errors");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const debug = (0, _debug.getDebug)('base-scraper-with-browser');
var LoginBaseResults = /*#__PURE__*/function (LoginBaseResults) {
  LoginBaseResults["Success"] = "SUCCESS";
  LoginBaseResults["UnknownError"] = "UNKNOWN_ERROR";
  return LoginBaseResults;
}(LoginBaseResults || {});
const {
  Timeout,
  Generic,
  General,
  ...rest
} = _errors.ScraperErrorTypes;
const LoginResults = exports.LoginResults = {
  ...rest,
  ...LoginBaseResults
};

// eslint-disable-next-line @typescript-eslint/no-redeclare

async function getKeyByValue(object, value, page) {
  const keys = Object.keys(object);
  for (const key of keys) {
    // @ts-ignore
    const conditions = object[key];
    for (const condition of conditions) {
      let result = false;
      if (condition instanceof RegExp) {
        result = condition.test(value);
      } else if (typeof condition === 'function') {
        result = await condition({
          page,
          value
        });
      } else {
        result = value.toLowerCase() === condition.toLowerCase();
      }
      if (result) {
        // @ts-ignore
        return Promise.resolve(key);
      }
    }
  }
  return Promise.resolve(LoginResults.UnknownError);
}
function createGeneralError() {
  return {
    success: false,
    errorType: _errors.ScraperErrorTypes.General
  };
}
class BaseScraperWithBrowser extends _baseScraper.BaseScraper {
  cleanups = [];
  defaultViewportSize = {
    width: 1024,
    height: 768
  };

  // NOTICE - it is discouraged to use bang (!) in general. It is used here because
  // all the classes that inherit from this base assume is it mandatory.

  getViewPort() {
    return this.options.viewportSize ?? this.defaultViewportSize;
  }
  async initialize() {
    await super.initialize();
    debug('initialize scraper');
    this.emitProgress(_definitions.ScraperProgressTypes.Initializing);
    const page = await this.initializePage();
    await page.setCacheEnabled(false); // Clear cache and avoid 300's response status

    if (!page) {
      debug('failed to initiate a browser page, exit');
      return;
    }
    this.page = page;
    this.cleanups.push(() => page.close());
    if (this.options.defaultTimeout) {
      this.page.setDefaultTimeout(this.options.defaultTimeout);
    }
    if (this.options.preparePage) {
      debug("execute 'preparePage' interceptor provided in options");
      await this.options.preparePage(this.page);
    }
    const viewport = this.getViewPort();
    debug(`set viewport to width ${viewport.width}, height ${viewport.height}`);
    await this.page.setViewport({
      width: viewport.width,
      height: viewport.height
    });
    this.page.on('requestfailed', request => {
      debug('Request failed: %s %s', request.failure()?.errorText, request.url());
    });
  }
  async initializePage() {
    debug('initialize browser page');
    if ('browserContext' in this.options) {
      debug('Using the browser context provided in options');
      return this.options.browserContext.newPage();
    }
    if ('browser' in this.options) {
      debug('Using the browser instance provided in options');
      const {
        browser
      } = this.options;

      /**
       * For backward compatibility, we will close the browser even if we didn't create it
       */
      if (!this.options.skipCloseBrowser) {
        this.cleanups.push(async () => {
          debug('closing the browser');
          await browser.close();
        });
      }
      return browser.newPage();
    }
    const {
      timeout,
      args,
      executablePath,
      showBrowser
    } = this.options;
    const headless = !showBrowser;
    debug(`launch a browser with headless mode = ${headless}`);
    const browser = await _puppeteer.default.launch({
      env: this.options.verbose ? {
        DEBUG: '*',
        ...process.env
      } : undefined,
      headless,
      executablePath,
      args,
      timeout
    });
    this.cleanups.push(async () => {
      debug('closing the browser');
      await browser.close();
    });
    if (this.options.prepareBrowser) {
      debug("execute 'prepareBrowser' interceptor provided in options");
      await this.options.prepareBrowser(browser);
    }
    debug('create a new browser page');
    return browser.newPage();
  }
  async navigateTo(url, waitUntil = 'load', retries = this.options.navigationRetryCount ?? 0) {
    const response = await this.page?.goto(url, {
      waitUntil
    });
    if (response === null) {
      // note: response will be null when navigating to same url while changing the hash part.
      // the condition below will always accept null as valid result.
      return;
    }
    if (!response) {
      throw new Error(`Error while trying to navigate to url ${url}, response is undefined`);
    }
    if (!response.ok()) {
      const status = response.status();
      if (retries > 0) {
        debug(`Failed to navigate to url ${url}, status code: ${status}, retrying ${retries} more times`);
        await this.navigateTo(url, waitUntil, retries - 1);
      } else {
        throw new Error(`Failed to navigate to url ${url}, status code: ${status}`);
      }
    }
  }

  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  getLoginOptions(_credentials) {
    throw new Error(`getLoginOptions() is not created in ${this.options.companyId}`);
  }
  async fillInputs(pageOrFrame, fields) {
    const modified = [...fields];
    const input = modified.shift();
    if (!input) {
      return;
    }
    await (0, _elementsInteractions.fillInput)(pageOrFrame, input.selector, input.value);
    if (modified.length) {
      await this.fillInputs(pageOrFrame, modified);
    }
  }
  async login(credentials) {
    if (!credentials || !this.page) {
      return createGeneralError();
    }
    debug('execute login process');
    const loginOptions = this.getLoginOptions(credentials);
    if (loginOptions.userAgent) {
      debug('set custom user agent provided in options');
      await this.page.setUserAgent(loginOptions.userAgent);
    }
    debug('navigate to login url');
    await this.navigateTo(loginOptions.loginUrl, loginOptions.waitUntil);
    if (loginOptions.checkReadiness) {
      debug("execute 'checkReadiness' interceptor provided in login options");
      await loginOptions.checkReadiness();
    } else if (typeof loginOptions.submitButtonSelector === 'string') {
      debug('wait until submit button is available');
      await (0, _elementsInteractions.waitUntilElementFound)(this.page, loginOptions.submitButtonSelector);
    }
    let loginFrameOrPage = this.page;
    if (loginOptions.preAction) {
      debug("execute 'preAction' interceptor provided in login options");
      loginFrameOrPage = (await loginOptions.preAction()) || this.page;
    }
    debug('fill login components input with relevant values');
    await this.fillInputs(loginFrameOrPage, loginOptions.fields);
    debug('click on login submit button');
    if (typeof loginOptions.submitButtonSelector === 'string') {
      await (0, _elementsInteractions.clickButton)(loginFrameOrPage, loginOptions.submitButtonSelector);
    } else {
      await loginOptions.submitButtonSelector();
    }
    this.emitProgress(_definitions.ScraperProgressTypes.LoggingIn);
    if (loginOptions.postAction) {
      debug("execute 'postAction' interceptor provided in login options");
      await loginOptions.postAction();
    } else {
      debug('wait for page navigation');
      await (0, _navigation.waitForNavigation)(this.page);
    }
    debug('check login result');
    const current = await (0, _navigation.getCurrentUrl)(this.page, true);
    debug(`[LOGIN DEBUG] Current URL after login: ${current}`);
    debug('[LOGIN DEBUG] Checking against possible results:', loginOptions.possibleResults);
    const loginResult = await getKeyByValue(loginOptions.possibleResults, current, this.page);
    debug(`[LOGIN DEBUG] Matched login result: ${loginResult}`);
    debug(`handle login results ${loginResult}`);
    return this.handleLoginResult(loginResult);
  }
  async terminate(_success) {
    debug(`terminating browser with success = ${_success}`);
    this.emitProgress(_definitions.ScraperProgressTypes.Terminating);
    if (!_success && !!this.options.storeFailureScreenShotPath) {
      debug(`create a snapshot before terminated in ${this.options.storeFailureScreenShotPath}`);
      await this.page.screenshot({
        path: this.options.storeFailureScreenShotPath,
        fullPage: true
      });
    }
    for (const [i, cleanup] of this.cleanups.reverse().entries()) {
      try {
        debug(`[TERMINATE] Running cleanup #${i}`);
        await cleanup();
        debug(`[TERMINATE] Cleanup #${i} finished successfully`);
      } catch (err) {
        debug(`[TERMINATE] Cleanup #${i} failed:`, err);
        const errorObj = err;
        if (errorObj && errorObj.message && errorObj.message.includes('No target with given id found')) {
          debug(`[TERMINATE] Suppressing Puppeteer closeTarget error for cleanup #${i}`);
        } else {
          throw err;
        }
      }
    }
    this.cleanups = [];
  }
  handleLoginResult(loginResult) {
    switch (loginResult) {
      case LoginResults.Success:
        this.emitProgress(_definitions.ScraperProgressTypes.LoginSuccess);
        return {
          success: true
        };
      case LoginResults.InvalidPassword:
      case LoginResults.UnknownError:
        this.emitProgress(_definitions.ScraperProgressTypes.LoginFailed);
        return {
          success: false,
          errorType: loginResult === LoginResults.InvalidPassword ? _errors.ScraperErrorTypes.InvalidPassword : _errors.ScraperErrorTypes.General,
          errorMessage: `Login failed with ${loginResult} error`
        };
      case LoginResults.ChangePassword:
        this.emitProgress(_definitions.ScraperProgressTypes.ChangePassword);
        return {
          success: false,
          errorType: _errors.ScraperErrorTypes.ChangePassword
        };
      default:
        throw new Error(`unexpected login result "${loginResult}"`);
    }
  }
}
exports.BaseScraperWithBrowser = BaseScraperWithBrowser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcHVwcGV0ZWVyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfZGVmaW5pdGlvbnMiLCJfZGVidWciLCJfZWxlbWVudHNJbnRlcmFjdGlvbnMiLCJfbmF2aWdhdGlvbiIsIl9iYXNlU2NyYXBlciIsIl9lcnJvcnMiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkZWJ1ZyIsImdldERlYnVnIiwiTG9naW5CYXNlUmVzdWx0cyIsIlRpbWVvdXQiLCJHZW5lcmljIiwiR2VuZXJhbCIsInJlc3QiLCJTY3JhcGVyRXJyb3JUeXBlcyIsIkxvZ2luUmVzdWx0cyIsImV4cG9ydHMiLCJnZXRLZXlCeVZhbHVlIiwib2JqZWN0IiwidmFsdWUiLCJwYWdlIiwia2V5cyIsIk9iamVjdCIsImtleSIsImNvbmRpdGlvbnMiLCJjb25kaXRpb24iLCJyZXN1bHQiLCJSZWdFeHAiLCJ0ZXN0IiwidG9Mb3dlckNhc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsIlVua25vd25FcnJvciIsImNyZWF0ZUdlbmVyYWxFcnJvciIsInN1Y2Nlc3MiLCJlcnJvclR5cGUiLCJCYXNlU2NyYXBlcldpdGhCcm93c2VyIiwiQmFzZVNjcmFwZXIiLCJjbGVhbnVwcyIsImRlZmF1bHRWaWV3cG9ydFNpemUiLCJ3aWR0aCIsImhlaWdodCIsImdldFZpZXdQb3J0Iiwib3B0aW9ucyIsInZpZXdwb3J0U2l6ZSIsImluaXRpYWxpemUiLCJlbWl0UHJvZ3Jlc3MiLCJTY3JhcGVyUHJvZ3Jlc3NUeXBlcyIsIkluaXRpYWxpemluZyIsImluaXRpYWxpemVQYWdlIiwic2V0Q2FjaGVFbmFibGVkIiwicHVzaCIsImNsb3NlIiwiZGVmYXVsdFRpbWVvdXQiLCJzZXREZWZhdWx0VGltZW91dCIsInByZXBhcmVQYWdlIiwidmlld3BvcnQiLCJzZXRWaWV3cG9ydCIsIm9uIiwicmVxdWVzdCIsImZhaWx1cmUiLCJlcnJvclRleHQiLCJ1cmwiLCJicm93c2VyQ29udGV4dCIsIm5ld1BhZ2UiLCJicm93c2VyIiwic2tpcENsb3NlQnJvd3NlciIsInRpbWVvdXQiLCJhcmdzIiwiZXhlY3V0YWJsZVBhdGgiLCJzaG93QnJvd3NlciIsImhlYWRsZXNzIiwicHVwcGV0ZWVyIiwibGF1bmNoIiwiZW52IiwidmVyYm9zZSIsIkRFQlVHIiwicHJvY2VzcyIsInVuZGVmaW5lZCIsInByZXBhcmVCcm93c2VyIiwibmF2aWdhdGVUbyIsIndhaXRVbnRpbCIsInJldHJpZXMiLCJuYXZpZ2F0aW9uUmV0cnlDb3VudCIsInJlc3BvbnNlIiwiZ290byIsIkVycm9yIiwib2siLCJzdGF0dXMiLCJnZXRMb2dpbk9wdGlvbnMiLCJfY3JlZGVudGlhbHMiLCJjb21wYW55SWQiLCJmaWxsSW5wdXRzIiwicGFnZU9yRnJhbWUiLCJmaWVsZHMiLCJtb2RpZmllZCIsImlucHV0Iiwic2hpZnQiLCJmaWxsSW5wdXQiLCJzZWxlY3RvciIsImxlbmd0aCIsImxvZ2luIiwiY3JlZGVudGlhbHMiLCJsb2dpbk9wdGlvbnMiLCJ1c2VyQWdlbnQiLCJzZXRVc2VyQWdlbnQiLCJsb2dpblVybCIsImNoZWNrUmVhZGluZXNzIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJ3YWl0VW50aWxFbGVtZW50Rm91bmQiLCJsb2dpbkZyYW1lT3JQYWdlIiwicHJlQWN0aW9uIiwiY2xpY2tCdXR0b24iLCJMb2dnaW5nSW4iLCJwb3N0QWN0aW9uIiwid2FpdEZvck5hdmlnYXRpb24iLCJjdXJyZW50IiwiZ2V0Q3VycmVudFVybCIsInBvc3NpYmxlUmVzdWx0cyIsImxvZ2luUmVzdWx0IiwiaGFuZGxlTG9naW5SZXN1bHQiLCJ0ZXJtaW5hdGUiLCJfc3VjY2VzcyIsIlRlcm1pbmF0aW5nIiwic3RvcmVGYWlsdXJlU2NyZWVuU2hvdFBhdGgiLCJzY3JlZW5zaG90IiwicGF0aCIsImZ1bGxQYWdlIiwiaSIsImNsZWFudXAiLCJyZXZlcnNlIiwiZW50cmllcyIsImVyciIsImVycm9yT2JqIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiU3VjY2VzcyIsIkxvZ2luU3VjY2VzcyIsIkludmFsaWRQYXNzd29yZCIsIkxvZ2luRmFpbGVkIiwiZXJyb3JNZXNzYWdlIiwiQ2hhbmdlUGFzc3dvcmQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvc2NyYXBlcnMvYmFzZS1zY3JhcGVyLXdpdGgtYnJvd3Nlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcHVwcGV0ZWVyLCB7IHR5cGUgRnJhbWUsIHR5cGUgUGFnZSwgdHlwZSBQdXBwZXRlZXJMaWZlQ3ljbGVFdmVudCB9IGZyb20gJ3B1cHBldGVlcic7XHJcbmltcG9ydCB7IFNjcmFwZXJQcm9ncmVzc1R5cGVzIH0gZnJvbSAnLi4vZGVmaW5pdGlvbnMnO1xyXG5pbXBvcnQgeyBnZXREZWJ1ZyB9IGZyb20gJy4uL2hlbHBlcnMvZGVidWcnO1xyXG5pbXBvcnQgeyBjbGlja0J1dHRvbiwgZmlsbElucHV0LCB3YWl0VW50aWxFbGVtZW50Rm91bmQgfSBmcm9tICcuLi9oZWxwZXJzL2VsZW1lbnRzLWludGVyYWN0aW9ucyc7XHJcbmltcG9ydCB7IGdldEN1cnJlbnRVcmwsIHdhaXRGb3JOYXZpZ2F0aW9uIH0gZnJvbSAnLi4vaGVscGVycy9uYXZpZ2F0aW9uJztcclxuaW1wb3J0IHsgQmFzZVNjcmFwZXIgfSBmcm9tICcuL2Jhc2Utc2NyYXBlcic7XHJcbmltcG9ydCB7IFNjcmFwZXJFcnJvclR5cGVzIH0gZnJvbSAnLi9lcnJvcnMnO1xyXG5pbXBvcnQgeyB0eXBlIFNjcmFwZXJDcmVkZW50aWFscywgdHlwZSBTY3JhcGVyU2NyYXBpbmdSZXN1bHQgfSBmcm9tICcuL2ludGVyZmFjZSc7XHJcblxyXG5jb25zdCBkZWJ1ZyA9IGdldERlYnVnKCdiYXNlLXNjcmFwZXItd2l0aC1icm93c2VyJyk7XHJcblxyXG5lbnVtIExvZ2luQmFzZVJlc3VsdHMge1xyXG4gIFN1Y2Nlc3MgPSAnU1VDQ0VTUycsXHJcbiAgVW5rbm93bkVycm9yID0gJ1VOS05PV05fRVJST1InLFxyXG59XHJcblxyXG5jb25zdCB7IFRpbWVvdXQsIEdlbmVyaWMsIEdlbmVyYWwsIC4uLnJlc3QgfSA9IFNjcmFwZXJFcnJvclR5cGVzO1xyXG5leHBvcnQgY29uc3QgTG9naW5SZXN1bHRzID0ge1xyXG4gIC4uLnJlc3QsXHJcbiAgLi4uTG9naW5CYXNlUmVzdWx0cyxcclxufTtcclxuXHJcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tcmVkZWNsYXJlXHJcbmV4cG9ydCB0eXBlIExvZ2luUmVzdWx0cyA9XHJcbiAgfCBFeGNsdWRlPFNjcmFwZXJFcnJvclR5cGVzLCBTY3JhcGVyRXJyb3JUeXBlcy5UaW1lb3V0IHwgU2NyYXBlckVycm9yVHlwZXMuR2VuZXJpYyB8IFNjcmFwZXJFcnJvclR5cGVzLkdlbmVyYWw+XHJcbiAgfCBMb2dpbkJhc2VSZXN1bHRzO1xyXG5cclxuZXhwb3J0IHR5cGUgUG9zc2libGVMb2dpblJlc3VsdHMgPSB7XHJcbiAgW2tleSBpbiBMb2dpblJlc3VsdHNdPzogKHN0cmluZyB8IFJlZ0V4cCB8ICgob3B0aW9ucz86IHsgcGFnZT86IFBhZ2UgfSkgPT4gUHJvbWlzZTxib29sZWFuPikpW107XHJcbn07XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExvZ2luT3B0aW9ucyB7XHJcbiAgbG9naW5Vcmw6IHN0cmluZztcclxuICBjaGVja1JlYWRpbmVzcz86ICgpID0+IFByb21pc2U8dm9pZD47XHJcbiAgZmllbGRzOiB7IHNlbGVjdG9yOiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfVtdO1xyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBzdHJpbmcgfCAoKCkgPT4gUHJvbWlzZTx2b2lkPik7XHJcbiAgcHJlQWN0aW9uPzogKCkgPT4gUHJvbWlzZTxGcmFtZSB8IHZvaWQ+O1xyXG4gIHBvc3RBY3Rpb24/OiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xyXG4gIHBvc3NpYmxlUmVzdWx0czogUG9zc2libGVMb2dpblJlc3VsdHM7XHJcbiAgdXNlckFnZW50Pzogc3RyaW5nO1xyXG4gIHdhaXRVbnRpbD86IFB1cHBldGVlckxpZmVDeWNsZUV2ZW50O1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRLZXlCeVZhbHVlKG9iamVjdDogUG9zc2libGVMb2dpblJlc3VsdHMsIHZhbHVlOiBzdHJpbmcsIHBhZ2U6IFBhZ2UpOiBQcm9taXNlPExvZ2luUmVzdWx0cz4ge1xyXG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpO1xyXG4gIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcclxuICAgIC8vIEB0cy1pZ25vcmVcclxuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBvYmplY3Rba2V5XTtcclxuXHJcbiAgICBmb3IgKGNvbnN0IGNvbmRpdGlvbiBvZiBjb25kaXRpb25zKSB7XHJcbiAgICAgIGxldCByZXN1bHQgPSBmYWxzZTtcclxuXHJcbiAgICAgIGlmIChjb25kaXRpb24gaW5zdGFuY2VvZiBSZWdFeHApIHtcclxuICAgICAgICByZXN1bHQgPSBjb25kaXRpb24udGVzdCh2YWx1ZSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNvbmRpdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IGNvbmRpdGlvbih7IHBhZ2UsIHZhbHVlIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlc3VsdCA9IHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IGNvbmRpdGlvbi50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoa2V5KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShMb2dpblJlc3VsdHMuVW5rbm93bkVycm9yKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY3JlYXRlR2VuZXJhbEVycm9yKCk6IFNjcmFwZXJTY3JhcGluZ1Jlc3VsdCB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgZXJyb3JUeXBlOiBTY3JhcGVyRXJyb3JUeXBlcy5HZW5lcmFsLFxyXG4gIH07XHJcbn1cclxuXHJcbmNsYXNzIEJhc2VTY3JhcGVyV2l0aEJyb3dzZXI8VENyZWRlbnRpYWxzIGV4dGVuZHMgU2NyYXBlckNyZWRlbnRpYWxzPiBleHRlbmRzIEJhc2VTY3JhcGVyPFRDcmVkZW50aWFscz4ge1xyXG4gIHByaXZhdGUgY2xlYW51cHM6IEFycmF5PCgpID0+IFByb21pc2U8dm9pZD4+ID0gW107XHJcblxyXG4gIHByaXZhdGUgZGVmYXVsdFZpZXdwb3J0U2l6ZSA9IHtcclxuICAgIHdpZHRoOiAxMDI0LFxyXG4gICAgaGVpZ2h0OiA3NjgsXHJcbiAgfTtcclxuXHJcbiAgLy8gTk9USUNFIC0gaXQgaXMgZGlzY291cmFnZWQgdG8gdXNlIGJhbmcgKCEpIGluIGdlbmVyYWwuIEl0IGlzIHVzZWQgaGVyZSBiZWNhdXNlXHJcbiAgLy8gYWxsIHRoZSBjbGFzc2VzIHRoYXQgaW5oZXJpdCBmcm9tIHRoaXMgYmFzZSBhc3N1bWUgaXMgaXQgbWFuZGF0b3J5LlxyXG4gIHByb3RlY3RlZCBwYWdlITogUGFnZTtcclxuXHJcbiAgcHJvdGVjdGVkIGdldFZpZXdQb3J0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy52aWV3cG9ydFNpemUgPz8gdGhpcy5kZWZhdWx0Vmlld3BvcnRTaXplO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgaW5pdGlhbGl6ZSgpIHtcclxuICAgIGF3YWl0IHN1cGVyLmluaXRpYWxpemUoKTtcclxuICAgIGRlYnVnKCdpbml0aWFsaXplIHNjcmFwZXInKTtcclxuICAgIHRoaXMuZW1pdFByb2dyZXNzKFNjcmFwZXJQcm9ncmVzc1R5cGVzLkluaXRpYWxpemluZyk7XHJcblxyXG4gICAgY29uc3QgcGFnZSA9IGF3YWl0IHRoaXMuaW5pdGlhbGl6ZVBhZ2UoKTtcclxuICAgIGF3YWl0IHBhZ2Uuc2V0Q2FjaGVFbmFibGVkKGZhbHNlKTsgLy8gQ2xlYXIgY2FjaGUgYW5kIGF2b2lkIDMwMCdzIHJlc3BvbnNlIHN0YXR1c1xyXG5cclxuICAgIGlmICghcGFnZSkge1xyXG4gICAgICBkZWJ1ZygnZmFpbGVkIHRvIGluaXRpYXRlIGEgYnJvd3NlciBwYWdlLCBleGl0Jyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnBhZ2UgPSBwYWdlO1xyXG5cclxuICAgIHRoaXMuY2xlYW51cHMucHVzaCgoKSA9PiBwYWdlLmNsb3NlKCkpO1xyXG5cclxuICAgIGlmICh0aGlzLm9wdGlvbnMuZGVmYXVsdFRpbWVvdXQpIHtcclxuICAgICAgdGhpcy5wYWdlLnNldERlZmF1bHRUaW1lb3V0KHRoaXMub3B0aW9ucy5kZWZhdWx0VGltZW91dCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMub3B0aW9ucy5wcmVwYXJlUGFnZSkge1xyXG4gICAgICBkZWJ1ZyhcImV4ZWN1dGUgJ3ByZXBhcmVQYWdlJyBpbnRlcmNlcHRvciBwcm92aWRlZCBpbiBvcHRpb25zXCIpO1xyXG4gICAgICBhd2FpdCB0aGlzLm9wdGlvbnMucHJlcGFyZVBhZ2UodGhpcy5wYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB2aWV3cG9ydCA9IHRoaXMuZ2V0Vmlld1BvcnQoKTtcclxuICAgIGRlYnVnKGBzZXQgdmlld3BvcnQgdG8gd2lkdGggJHt2aWV3cG9ydC53aWR0aH0sIGhlaWdodCAke3ZpZXdwb3J0LmhlaWdodH1gKTtcclxuICAgIGF3YWl0IHRoaXMucGFnZS5zZXRWaWV3cG9ydCh7XHJcbiAgICAgIHdpZHRoOiB2aWV3cG9ydC53aWR0aCxcclxuICAgICAgaGVpZ2h0OiB2aWV3cG9ydC5oZWlnaHQsXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnBhZ2Uub24oJ3JlcXVlc3RmYWlsZWQnLCByZXF1ZXN0ID0+IHtcclxuICAgICAgZGVidWcoJ1JlcXVlc3QgZmFpbGVkOiAlcyAlcycsIHJlcXVlc3QuZmFpbHVyZSgpPy5lcnJvclRleHQsIHJlcXVlc3QudXJsKCkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVQYWdlKCkge1xyXG4gICAgZGVidWcoJ2luaXRpYWxpemUgYnJvd3NlciBwYWdlJyk7XHJcbiAgICBpZiAoJ2Jyb3dzZXJDb250ZXh0JyBpbiB0aGlzLm9wdGlvbnMpIHtcclxuICAgICAgZGVidWcoJ1VzaW5nIHRoZSBicm93c2VyIGNvbnRleHQgcHJvdmlkZWQgaW4gb3B0aW9ucycpO1xyXG4gICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmJyb3dzZXJDb250ZXh0Lm5ld1BhZ2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoJ2Jyb3dzZXInIGluIHRoaXMub3B0aW9ucykge1xyXG4gICAgICBkZWJ1ZygnVXNpbmcgdGhlIGJyb3dzZXIgaW5zdGFuY2UgcHJvdmlkZWQgaW4gb3B0aW9ucycpO1xyXG4gICAgICBjb25zdCB7IGJyb3dzZXIgfSA9IHRoaXMub3B0aW9ucztcclxuXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBGb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSwgd2Ugd2lsbCBjbG9zZSB0aGUgYnJvd3NlciBldmVuIGlmIHdlIGRpZG4ndCBjcmVhdGUgaXRcclxuICAgICAgICovXHJcbiAgICAgIGlmICghdGhpcy5vcHRpb25zLnNraXBDbG9zZUJyb3dzZXIpIHtcclxuICAgICAgICB0aGlzLmNsZWFudXBzLnB1c2goYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgZGVidWcoJ2Nsb3NpbmcgdGhlIGJyb3dzZXInKTtcclxuICAgICAgICAgIGF3YWl0IGJyb3dzZXIuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGJyb3dzZXIubmV3UGFnZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgdGltZW91dCwgYXJncywgZXhlY3V0YWJsZVBhdGgsIHNob3dCcm93c2VyIH0gPSB0aGlzLm9wdGlvbnM7XHJcblxyXG4gICAgY29uc3QgaGVhZGxlc3MgPSAhc2hvd0Jyb3dzZXI7XHJcbiAgICBkZWJ1ZyhgbGF1bmNoIGEgYnJvd3NlciB3aXRoIGhlYWRsZXNzIG1vZGUgPSAke2hlYWRsZXNzfWApO1xyXG5cclxuICAgIGNvbnN0IGJyb3dzZXIgPSBhd2FpdCBwdXBwZXRlZXIubGF1bmNoKHtcclxuICAgICAgZW52OiB0aGlzLm9wdGlvbnMudmVyYm9zZSA/IHsgREVCVUc6ICcqJywgLi4ucHJvY2Vzcy5lbnYgfSA6IHVuZGVmaW5lZCxcclxuICAgICAgaGVhZGxlc3MsXHJcbiAgICAgIGV4ZWN1dGFibGVQYXRoLFxyXG4gICAgICBhcmdzLFxyXG4gICAgICB0aW1lb3V0LFxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5jbGVhbnVwcy5wdXNoKGFzeW5jICgpID0+IHtcclxuICAgICAgZGVidWcoJ2Nsb3NpbmcgdGhlIGJyb3dzZXInKTtcclxuICAgICAgYXdhaXQgYnJvd3Nlci5jbG9zZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKHRoaXMub3B0aW9ucy5wcmVwYXJlQnJvd3Nlcikge1xyXG4gICAgICBkZWJ1ZyhcImV4ZWN1dGUgJ3ByZXBhcmVCcm93c2VyJyBpbnRlcmNlcHRvciBwcm92aWRlZCBpbiBvcHRpb25zXCIpO1xyXG4gICAgICBhd2FpdCB0aGlzLm9wdGlvbnMucHJlcGFyZUJyb3dzZXIoYnJvd3Nlcik7XHJcbiAgICB9XHJcblxyXG4gICAgZGVidWcoJ2NyZWF0ZSBhIG5ldyBicm93c2VyIHBhZ2UnKTtcclxuICAgIHJldHVybiBicm93c2VyLm5ld1BhZ2UoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIG5hdmlnYXRlVG8oXHJcbiAgICB1cmw6IHN0cmluZyxcclxuICAgIHdhaXRVbnRpbDogUHVwcGV0ZWVyTGlmZUN5Y2xlRXZlbnQgfCB1bmRlZmluZWQgPSAnbG9hZCcsXHJcbiAgICByZXRyaWVzID0gdGhpcy5vcHRpb25zLm5hdmlnYXRpb25SZXRyeUNvdW50ID8/IDAsXHJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMucGFnZT8uZ290byh1cmwsIHsgd2FpdFVudGlsIH0pO1xyXG4gICAgaWYgKHJlc3BvbnNlID09PSBudWxsKSB7XHJcbiAgICAgIC8vIG5vdGU6IHJlc3BvbnNlIHdpbGwgYmUgbnVsbCB3aGVuIG5hdmlnYXRpbmcgdG8gc2FtZSB1cmwgd2hpbGUgY2hhbmdpbmcgdGhlIGhhc2ggcGFydC5cclxuICAgICAgLy8gdGhlIGNvbmRpdGlvbiBiZWxvdyB3aWxsIGFsd2F5cyBhY2NlcHQgbnVsbCBhcyB2YWxpZCByZXN1bHQuXHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXJlc3BvbnNlKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3Igd2hpbGUgdHJ5aW5nIHRvIG5hdmlnYXRlIHRvIHVybCAke3VybH0sIHJlc3BvbnNlIGlzIHVuZGVmaW5lZGApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghcmVzcG9uc2Uub2soKSkge1xyXG4gICAgICBjb25zdCBzdGF0dXMgPSByZXNwb25zZS5zdGF0dXMoKTtcclxuICAgICAgaWYgKHJldHJpZXMgPiAwKSB7XHJcbiAgICAgICAgZGVidWcoYEZhaWxlZCB0byBuYXZpZ2F0ZSB0byB1cmwgJHt1cmx9LCBzdGF0dXMgY29kZTogJHtzdGF0dXN9LCByZXRyeWluZyAke3JldHJpZXN9IG1vcmUgdGltZXNgKTtcclxuICAgICAgICBhd2FpdCB0aGlzLm5hdmlnYXRlVG8odXJsLCB3YWl0VW50aWwsIHJldHJpZXMgLSAxKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBuYXZpZ2F0ZSB0byB1cmwgJHt1cmx9LCBzdGF0dXMgY29kZTogJHtzdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcclxuICBnZXRMb2dpbk9wdGlvbnMoX2NyZWRlbnRpYWxzOiBTY3JhcGVyQ3JlZGVudGlhbHMpOiBMb2dpbk9wdGlvbnMge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGBnZXRMb2dpbk9wdGlvbnMoKSBpcyBub3QgY3JlYXRlZCBpbiAke3RoaXMub3B0aW9ucy5jb21wYW55SWR9YCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBmaWxsSW5wdXRzKHBhZ2VPckZyYW1lOiBQYWdlIHwgRnJhbWUsIGZpZWxkczogeyBzZWxlY3Rvcjogc3RyaW5nOyB2YWx1ZTogc3RyaW5nIH1bXSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgbW9kaWZpZWQgPSBbLi4uZmllbGRzXTtcclxuICAgIGNvbnN0IGlucHV0ID0gbW9kaWZpZWQuc2hpZnQoKTtcclxuXHJcbiAgICBpZiAoIWlucHV0KSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGF3YWl0IGZpbGxJbnB1dChwYWdlT3JGcmFtZSwgaW5wdXQuc2VsZWN0b3IsIGlucHV0LnZhbHVlKTtcclxuICAgIGlmIChtb2RpZmllZC5sZW5ndGgpIHtcclxuICAgICAgYXdhaXQgdGhpcy5maWxsSW5wdXRzKHBhZ2VPckZyYW1lLCBtb2RpZmllZCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2dpbihjcmVkZW50aWFsczogU2NyYXBlckNyZWRlbnRpYWxzKTogUHJvbWlzZTxTY3JhcGVyU2NyYXBpbmdSZXN1bHQ+IHtcclxuICAgIGlmICghY3JlZGVudGlhbHMgfHwgIXRoaXMucGFnZSkge1xyXG4gICAgICByZXR1cm4gY3JlYXRlR2VuZXJhbEVycm9yKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVidWcoJ2V4ZWN1dGUgbG9naW4gcHJvY2VzcycpO1xyXG4gICAgY29uc3QgbG9naW5PcHRpb25zID0gdGhpcy5nZXRMb2dpbk9wdGlvbnMoY3JlZGVudGlhbHMpO1xyXG5cclxuICAgIGlmIChsb2dpbk9wdGlvbnMudXNlckFnZW50KSB7XHJcbiAgICAgIGRlYnVnKCdzZXQgY3VzdG9tIHVzZXIgYWdlbnQgcHJvdmlkZWQgaW4gb3B0aW9ucycpO1xyXG4gICAgICBhd2FpdCB0aGlzLnBhZ2Uuc2V0VXNlckFnZW50KGxvZ2luT3B0aW9ucy51c2VyQWdlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlYnVnKCduYXZpZ2F0ZSB0byBsb2dpbiB1cmwnKTtcclxuICAgIGF3YWl0IHRoaXMubmF2aWdhdGVUbyhsb2dpbk9wdGlvbnMubG9naW5VcmwsIGxvZ2luT3B0aW9ucy53YWl0VW50aWwpO1xyXG4gICAgaWYgKGxvZ2luT3B0aW9ucy5jaGVja1JlYWRpbmVzcykge1xyXG4gICAgICBkZWJ1ZyhcImV4ZWN1dGUgJ2NoZWNrUmVhZGluZXNzJyBpbnRlcmNlcHRvciBwcm92aWRlZCBpbiBsb2dpbiBvcHRpb25zXCIpO1xyXG4gICAgICBhd2FpdCBsb2dpbk9wdGlvbnMuY2hlY2tSZWFkaW5lc3MoKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGxvZ2luT3B0aW9ucy5zdWJtaXRCdXR0b25TZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgZGVidWcoJ3dhaXQgdW50aWwgc3VibWl0IGJ1dHRvbiBpcyBhdmFpbGFibGUnKTtcclxuICAgICAgYXdhaXQgd2FpdFVudGlsRWxlbWVudEZvdW5kKHRoaXMucGFnZSwgbG9naW5PcHRpb25zLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgbG9naW5GcmFtZU9yUGFnZTogUGFnZSB8IEZyYW1lIHwgbnVsbCA9IHRoaXMucGFnZTtcclxuICAgIGlmIChsb2dpbk9wdGlvbnMucHJlQWN0aW9uKSB7XHJcbiAgICAgIGRlYnVnKFwiZXhlY3V0ZSAncHJlQWN0aW9uJyBpbnRlcmNlcHRvciBwcm92aWRlZCBpbiBsb2dpbiBvcHRpb25zXCIpO1xyXG4gICAgICBsb2dpbkZyYW1lT3JQYWdlID0gKGF3YWl0IGxvZ2luT3B0aW9ucy5wcmVBY3Rpb24oKSkgfHwgdGhpcy5wYWdlO1xyXG4gICAgfVxyXG5cclxuICAgIGRlYnVnKCdmaWxsIGxvZ2luIGNvbXBvbmVudHMgaW5wdXQgd2l0aCByZWxldmFudCB2YWx1ZXMnKTtcclxuICAgIGF3YWl0IHRoaXMuZmlsbElucHV0cyhsb2dpbkZyYW1lT3JQYWdlLCBsb2dpbk9wdGlvbnMuZmllbGRzKTtcclxuICAgIGRlYnVnKCdjbGljayBvbiBsb2dpbiBzdWJtaXQgYnV0dG9uJyk7XHJcbiAgICBpZiAodHlwZW9mIGxvZ2luT3B0aW9ucy5zdWJtaXRCdXR0b25TZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgYXdhaXQgY2xpY2tCdXR0b24obG9naW5GcmFtZU9yUGFnZSwgbG9naW5PcHRpb25zLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGF3YWl0IGxvZ2luT3B0aW9ucy5zdWJtaXRCdXR0b25TZWxlY3RvcigpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5lbWl0UHJvZ3Jlc3MoU2NyYXBlclByb2dyZXNzVHlwZXMuTG9nZ2luZ0luKTtcclxuXHJcbiAgICBpZiAobG9naW5PcHRpb25zLnBvc3RBY3Rpb24pIHtcclxuICAgICAgZGVidWcoXCJleGVjdXRlICdwb3N0QWN0aW9uJyBpbnRlcmNlcHRvciBwcm92aWRlZCBpbiBsb2dpbiBvcHRpb25zXCIpO1xyXG4gICAgICBhd2FpdCBsb2dpbk9wdGlvbnMucG9zdEFjdGlvbigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGVidWcoJ3dhaXQgZm9yIHBhZ2UgbmF2aWdhdGlvbicpO1xyXG4gICAgICBhd2FpdCB3YWl0Rm9yTmF2aWdhdGlvbih0aGlzLnBhZ2UpO1xyXG4gICAgfVxyXG5cclxuICAgIGRlYnVnKCdjaGVjayBsb2dpbiByZXN1bHQnKTtcclxuICAgIGNvbnN0IGN1cnJlbnQgPSBhd2FpdCBnZXRDdXJyZW50VXJsKHRoaXMucGFnZSwgdHJ1ZSk7XHJcbiAgICBkZWJ1ZyhgW0xPR0lOIERFQlVHXSBDdXJyZW50IFVSTCBhZnRlciBsb2dpbjogJHtjdXJyZW50fWApO1xyXG4gICAgZGVidWcoJ1tMT0dJTiBERUJVR10gQ2hlY2tpbmcgYWdhaW5zdCBwb3NzaWJsZSByZXN1bHRzOicsIGxvZ2luT3B0aW9ucy5wb3NzaWJsZVJlc3VsdHMpO1xyXG4gICAgY29uc3QgbG9naW5SZXN1bHQgPSBhd2FpdCBnZXRLZXlCeVZhbHVlKGxvZ2luT3B0aW9ucy5wb3NzaWJsZVJlc3VsdHMsIGN1cnJlbnQsIHRoaXMucGFnZSk7XHJcbiAgICBkZWJ1ZyhgW0xPR0lOIERFQlVHXSBNYXRjaGVkIGxvZ2luIHJlc3VsdDogJHtsb2dpblJlc3VsdH1gKTtcclxuICAgIGRlYnVnKGBoYW5kbGUgbG9naW4gcmVzdWx0cyAke2xvZ2luUmVzdWx0fWApO1xyXG4gICAgcmV0dXJuIHRoaXMuaGFuZGxlTG9naW5SZXN1bHQobG9naW5SZXN1bHQpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgdGVybWluYXRlKF9zdWNjZXNzOiBib29sZWFuKSB7XHJcbiAgICBkZWJ1ZyhgdGVybWluYXRpbmcgYnJvd3NlciB3aXRoIHN1Y2Nlc3MgPSAke19zdWNjZXNzfWApO1xyXG4gICAgdGhpcy5lbWl0UHJvZ3Jlc3MoU2NyYXBlclByb2dyZXNzVHlwZXMuVGVybWluYXRpbmcpO1xyXG5cclxuICAgIGlmICghX3N1Y2Nlc3MgJiYgISF0aGlzLm9wdGlvbnMuc3RvcmVGYWlsdXJlU2NyZWVuU2hvdFBhdGgpIHtcclxuICAgICAgZGVidWcoYGNyZWF0ZSBhIHNuYXBzaG90IGJlZm9yZSB0ZXJtaW5hdGVkIGluICR7dGhpcy5vcHRpb25zLnN0b3JlRmFpbHVyZVNjcmVlblNob3RQYXRofWApO1xyXG4gICAgICBhd2FpdCB0aGlzLnBhZ2Uuc2NyZWVuc2hvdCh7XHJcbiAgICAgICAgcGF0aDogdGhpcy5vcHRpb25zLnN0b3JlRmFpbHVyZVNjcmVlblNob3RQYXRoLFxyXG4gICAgICAgIGZ1bGxQYWdlOiB0cnVlLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGNvbnN0IFtpLCBjbGVhbnVwXSBvZiB0aGlzLmNsZWFudXBzLnJldmVyc2UoKS5lbnRyaWVzKCkpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBkZWJ1ZyhgW1RFUk1JTkFURV0gUnVubmluZyBjbGVhbnVwICMke2l9YCk7XHJcbiAgICAgICAgYXdhaXQgY2xlYW51cCgpO1xyXG4gICAgICAgIGRlYnVnKGBbVEVSTUlOQVRFXSBDbGVhbnVwICMke2l9IGZpbmlzaGVkIHN1Y2Nlc3NmdWxseWApO1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBkZWJ1ZyhgW1RFUk1JTkFURV0gQ2xlYW51cCAjJHtpfSBmYWlsZWQ6YCwgZXJyKTtcclxuICAgICAgICBjb25zdCBlcnJvck9iaiA9IGVyciBhcyBFcnJvcjtcclxuICAgICAgICBpZiAoZXJyb3JPYmogJiYgZXJyb3JPYmoubWVzc2FnZSAmJiBlcnJvck9iai5tZXNzYWdlLmluY2x1ZGVzKCdObyB0YXJnZXQgd2l0aCBnaXZlbiBpZCBmb3VuZCcpKSB7XHJcbiAgICAgICAgICBkZWJ1ZyhgW1RFUk1JTkFURV0gU3VwcHJlc3NpbmcgUHVwcGV0ZWVyIGNsb3NlVGFyZ2V0IGVycm9yIGZvciBjbGVhbnVwICMke2l9YCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRocm93IGVycjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMuY2xlYW51cHMgPSBbXTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlTG9naW5SZXN1bHQobG9naW5SZXN1bHQ6IExvZ2luUmVzdWx0cykge1xyXG4gICAgc3dpdGNoIChsb2dpblJlc3VsdCkge1xyXG4gICAgICBjYXNlIExvZ2luUmVzdWx0cy5TdWNjZXNzOlxyXG4gICAgICAgIHRoaXMuZW1pdFByb2dyZXNzKFNjcmFwZXJQcm9ncmVzc1R5cGVzLkxvZ2luU3VjY2Vzcyk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICBjYXNlIExvZ2luUmVzdWx0cy5JbnZhbGlkUGFzc3dvcmQ6XHJcbiAgICAgIGNhc2UgTG9naW5SZXN1bHRzLlVua25vd25FcnJvcjpcclxuICAgICAgICB0aGlzLmVtaXRQcm9ncmVzcyhTY3JhcGVyUHJvZ3Jlc3NUeXBlcy5Mb2dpbkZhaWxlZCk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3JUeXBlOlxyXG4gICAgICAgICAgICBsb2dpblJlc3VsdCA9PT0gTG9naW5SZXN1bHRzLkludmFsaWRQYXNzd29yZFxyXG4gICAgICAgICAgICAgID8gU2NyYXBlckVycm9yVHlwZXMuSW52YWxpZFBhc3N3b3JkXHJcbiAgICAgICAgICAgICAgOiBTY3JhcGVyRXJyb3JUeXBlcy5HZW5lcmFsLFxyXG4gICAgICAgICAgZXJyb3JNZXNzYWdlOiBgTG9naW4gZmFpbGVkIHdpdGggJHtsb2dpblJlc3VsdH0gZXJyb3JgLFxyXG4gICAgICAgIH07XHJcbiAgICAgIGNhc2UgTG9naW5SZXN1bHRzLkNoYW5nZVBhc3N3b3JkOlxyXG4gICAgICAgIHRoaXMuZW1pdFByb2dyZXNzKFNjcmFwZXJQcm9ncmVzc1R5cGVzLkNoYW5nZVBhc3N3b3JkKTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICBlcnJvclR5cGU6IFNjcmFwZXJFcnJvclR5cGVzLkNoYW5nZVBhc3N3b3JkLFxyXG4gICAgICAgIH07XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmV4cGVjdGVkIGxvZ2luIHJlc3VsdCBcIiR7bG9naW5SZXN1bHR9XCJgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IEJhc2VTY3JhcGVyV2l0aEJy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
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.fetchGet = fetchGet;
exports.fetchGetWithinPage = fetchGetWithinPage;
exports.fetchGraphql = fetchGraphql;
exports.fetchPost = fetchPost;
exports.fetchPostWithinPage = fetchPostWithinPage;
var _nodeFetch = _interopRequireDefault(require("node-fetch"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const JSON_CONTENT_TYPE = 'application/json';
function getJsonHeaders() {
  return {
    Accept: JSON_CONTENT_TYPE,
    'Content-Type': JSON_CONTENT_TYPE
  };
}
async function fetchGet(url, extraHeaders) {
  let headers = getJsonHeaders();
  if (extraHeaders) {
    headers = Object.assign(headers, extraHeaders);
  }
  const request = {
    method: 'GET',
    headers
  };
  const fetchResult = await (0, _nodeFetch.default)(url, request);
  if (fetchResult.status !== 200) {
    throw new Error(`sending a request to the institute server returned with status code ${fetchResult.status}`);
  }
  return fetchResult.json();
}
async function fetchPost(url, data, extraHeaders = {}) {
  const request = {
    method: 'POST',
    headers: {
      ...getJsonHeaders(),
      ...extraHeaders
    },
    body: JSON.stringify(data)
  };
  const result = await (0, _nodeFetch.default)(url, request);
  return result.json();
}
async function fetchGraphql(url, query, variables = {}, extraHeaders = {}) {
  const result = await fetchPost(url, {
    operationName: null,
    query,
    variables
  }, extraHeaders);
  if (result.errors?.length) {
    throw new Error(result.errors[0].message);
  }
  return result.data;
}
function fetchGetWithinPage(page, url) {
  return page.evaluate(innerUrl => {
    return new Promise((resolve, reject) => {
      fetch(innerUrl, {
        credentials: 'include'
      }).then(result => {
        if (result.status === 204) {
          resolve(null);
        } else {
          resolve(result.json());
        }
      }).catch(e => {
        reject(e);
      });
    });
  }, url);
}
function fetchPostWithinPage(page, url, data, extraHeaders = {}) {
  return page.evaluate((innerUrl, innerData, innerExtraHeaders) => {
    return new Promise((resolve, reject) => {
      fetch(innerUrl, {
        method: 'POST',
        body: JSON.stringify(innerData),
        credentials: 'include',
        // eslint-disable-next-line prefer-object-spread
        headers: Object.assign({
          'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
        }, innerExtraHeaders)
      }).then(result => {
        if (result.status === 204) {
          // No content response
          resolve(null);
        } else {
          resolve(result.json());
        }
      }).catch(e => {
        reject(e);
      });
    });
  }, url, data, extraHeaders);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUZldGNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJKU09OX0NPTlRFTlRfVFlQRSIsImdldEpzb25IZWFkZXJzIiwiQWNjZXB0IiwiZmV0Y2hHZXQiLCJ1cmwiLCJleHRyYUhlYWRlcnMiLCJoZWFkZXJzIiwiT2JqZWN0IiwiYXNzaWduIiwicmVxdWVzdCIsIm1ldGhvZCIsImZldGNoUmVzdWx0Iiwibm9kZUZldGNoIiwic3RhdHVzIiwiRXJyb3IiLCJqc29uIiwiZmV0Y2hQb3N0IiwiZGF0YSIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVzdWx0IiwiZmV0Y2hHcmFwaHFsIiwicXVlcnkiLCJ2YXJpYWJsZXMiLCJvcGVyYXRpb25OYW1lIiwiZXJyb3JzIiwibGVuZ3RoIiwibWVzc2FnZSIsImZldGNoR2V0V2l0aGluUGFnZSIsInBhZ2UiLCJldmFsdWF0ZSIsImlubmVyVXJsIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmZXRjaCIsImNyZWRlbnRpYWxzIiwidGhlbiIsImNhdGNoIiwiZmV0Y2hQb3N0V2l0aGluUGFnZSIsImlubmVyRGF0YSIsImlubmVyRXh0cmFIZWFkZXJzIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2hlbHBlcnMvZmV0Y2gudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG5vZGVGZXRjaCBmcm9tICdub2RlLWZldGNoJztcclxuaW1wb3J0IHsgdHlwZSBQYWdlIH0gZnJvbSAncHVwcGV0ZWVyJztcclxuXHJcbmNvbnN0IEpTT05fQ09OVEVOVF9UWVBFID0gJ2FwcGxpY2F0aW9uL2pzb24nO1xyXG5cclxuZnVuY3Rpb24gZ2V0SnNvbkhlYWRlcnMoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIEFjY2VwdDogSlNPTl9DT05URU5UX1RZUEUsXHJcbiAgICAnQ29udGVudC1UeXBlJzogSlNPTl9DT05URU5UX1RZUEUsXHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoR2V0PFRSZXN1bHQ+KHVybDogc3RyaW5nLCBleHRyYUhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPFRSZXN1bHQ+IHtcclxuICBsZXQgaGVhZGVycyA9IGdldEpzb25IZWFkZXJzKCk7XHJcbiAgaWYgKGV4dHJhSGVhZGVycykge1xyXG4gICAgaGVhZGVycyA9IE9iamVjdC5hc3NpZ24oaGVhZGVycywgZXh0cmFIZWFkZXJzKTtcclxuICB9XHJcbiAgY29uc3QgcmVxdWVzdCA9IHtcclxuICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICBoZWFkZXJzLFxyXG4gIH07XHJcbiAgY29uc3QgZmV0Y2hSZXN1bHQgPSBhd2FpdCBub2RlRmV0Y2godXJsLCByZXF1ZXN0KTtcclxuXHJcbiAgaWYgKGZldGNoUmVzdWx0LnN0YXR1cyAhPT0gMjAwKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYHNlbmRpbmcgYSByZXF1ZXN0IHRvIHRoZSBpbnN0aXR1dGUgc2VydmVyIHJldHVybmVkIHdpdGggc3RhdHVzIGNvZGUgJHtmZXRjaFJlc3VsdC5zdGF0dXN9YCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gZmV0Y2hSZXN1bHQuanNvbigpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmV0Y2hQb3N0KHVybDogc3RyaW5nLCBkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+LCBleHRyYUhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSkge1xyXG4gIGNvbnN0IHJlcXVlc3QgPSB7XHJcbiAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIGhlYWRlcnM6IHsgLi4uZ2V0SnNvbkhlYWRlcnMoKSwgLi4uZXh0cmFIZWFkZXJzIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcclxuICB9O1xyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG5vZGVGZXRjaCh1cmwsIHJlcXVlc3QpO1xyXG4gIHJldHVybiByZXN1bHQuanNvbigpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZmV0Y2hHcmFwaHFsPFRSZXN1bHQ+KFxyXG4gIHVybDogc3RyaW5nLFxyXG4gIHF1ZXJ5OiBzdHJpbmcsXHJcbiAgdmFyaWFibGVzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9LFxyXG4gIGV4dHJhSGVhZGVyczogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9LFxyXG4pOiBQcm9taXNlPFRSZXN1bHQ+IHtcclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBmZXRjaFBvc3QodXJsLCB7IG9wZXJhdGlvbk5hbWU6IG51bGwsIHF1ZXJ5LCB2YXJpYWJsZXMgfSwgZXh0cmFIZWFkZXJzKTtcclxuICBpZiAocmVzdWx0LmVycm9ycz8ubGVuZ3RoKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmVycm9yc1swXS5tZXNzYWdlKTtcclxuICB9XHJcbiAgcmV0dXJuIHJlc3VsdC5kYXRhIGFzIFByb21pc2U8VFJlc3VsdD47XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmZXRjaEdldFdpdGhpblBhZ2U8VFJlc3VsdD4ocGFnZTogUGFnZSwgdXJsOiBzdHJpbmcpOiBQcm9taXNlPFRSZXN1bHQgfCBudWxsPiB7XHJcbiAgcmV0dXJuIHBhZ2UuZXZhbHVhdGUoaW5uZXJVcmwgPT4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPFRSZXN1bHQgfCBudWxsPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGZldGNoKGlubmVyVXJsLCB7XHJcbiAgICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJyxcclxuICAgICAgfSlcclxuICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IDIwNCkge1xyXG4gICAgICAgICAgICByZXNvbHZlKG51bGwpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaChlID0+IHtcclxuICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0sIHVybCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmZXRjaFBvc3RXaXRoaW5QYWdlPFRSZXN1bHQ+KFxyXG4gIHBhZ2U6IFBhZ2UsXHJcbiAgdXJsOiBzdHJpbmcsXHJcbiAgZGF0YTogUmVjb3JkPHN0cmluZywgYW55PixcclxuICBleHRyYUhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSxcclxuKTogUHJvbWlzZTxUUmVzdWx0IHwgbnVsbD4ge1xyXG4gIHJldHVybiBwYWdlLmV2YWx1YXRlKFxyXG4gICAgKGlubmVyVXJsOiBzdHJpbmcsIGlubmVyRGF0YTogUmVjb3JkPHN0cmluZywgYW55PiwgaW5uZXJFeHRyYUhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIGFueT4pID0+IHtcclxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFRSZXN1bHQgfCBudWxsPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgZmV0Y2goaW5uZXJVcmwsIHtcclxuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoaW5uZXJEYXRhKSxcclxuICAgICAgICAgIGNyZWRlbnRpYWxzOiAnaW5jbHVkZScsXHJcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLW9iamVjdC1zcHJlYWRcclxuICAgICAgICAgIGhlYWRlcnM6IE9iamVjdC5hc3NpZ24oXHJcbiAgICAgICAgICAgIHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgnIH0sXHJcbiAgICAgICAgICAgIGlubmVyRXh0cmFIZWFkZXJzLFxyXG4gICAgICAgICAgKSxcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IDIwNCkge1xyXG4gICAgICAgICAgICAgIC8vIE5vIGNvbnRlbnQgcmVzcG9uc2VcclxuICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY2F0Y2goZSA9PiB7XHJcbiAgICAgICAgICAgIHJlamVjdChlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH0sXHJcbiAgICB1cmwsXHJcbiAgICBkYXRhLFxyXG4gICAgZXh0cmFIZWFkZXJzLFxyXG4gICk7XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsSUFBQUEsVUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQW1DLFNBQUFELHVCQUFBRSxDQUFBLFdBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUsT0FBQSxFQUFBRixDQUFBO0FBR25DLE1BQU1HLGlCQUFpQixHQUFHLGtCQUFrQjtBQUU1QyxTQUFTQyxjQUFjQSxDQUFBLEVBQUc7RUFDeEIsT0FBTztJQUNMQyxNQUFNLEVBQUVGLGlCQUFpQjtJQUN6QixjQUFjLEVBQUVBO0VBQ2xCLENBQUM7QUFDSDtBQUVPLGVBQWVHLFFBQVFBLENBQVVDLEdBQVcsRUFBRUMsWUFBaUMsRUFBb0I7RUFDeEcsSUFBSUMsT0FBTyxHQUFHTCxjQUFjLENBQUMsQ0FBQztFQUM5QixJQUFJSSxZQUFZLEVBQUU7SUFDaEJDLE9BQU8sR0FBR0MsTUFBTSxDQUFDQyxNQUFNLENBQUNGLE9BQU8sRUFBRUQsWUFBWSxDQUFDO0VBQ2hEO0VBQ0EsTUFBTUksT0FBTyxHQUFH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